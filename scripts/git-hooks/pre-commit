#!/bin/sh
# =============================================================================
# PRE-COMMIT HOOK - Version Consistency Validation
# =============================================================================
# Ensures version numbers are consistent across all files before commit.
# Auto-syncs frontend to backend if mismatch detected.
# =============================================================================

powershell.exe -ExecutionPolicy Bypass -NoProfile -Command "
    \$ErrorActionPreference = 'SilentlyContinue'
    
    # Check version consistency
    \$backendPkg = Get-Content './backend/package.json' | ConvertFrom-Json
    \$frontendPkg = Get-Content './frontend/package.json' | ConvertFrom-Json
    
    if (\$backendPkg.version -ne \$frontendPkg.version) {
        Write-Host '[VERSION] Syncing frontend to backend...' -ForegroundColor Yellow
        \$frontendPkg.version = \$backendPkg.version
        \$frontendPkg | ConvertTo-Json -Depth 100 | Set-Content './frontend/package.json'
        git add './frontend/package.json'
    }
    
    exit 0
"

exit 0
